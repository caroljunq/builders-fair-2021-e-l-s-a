<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Elsa</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
  <app-root></app-root>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <div id="chart">
  </div>
  <script>

    function getTemp() {
      return new Promise((resolve, reject) => {
        let xhr = new XMLHttpRequest();

        xhr.open('GET', "https://4p9d4ru3bd.execute-api.us-east-1.amazonaws.com/prod/getTempData");
        xhr.addEventListener('loadend', () => {
          if (xhr.status == 200) {
            console.log("got the response")
            resolve(JSON.parse(xhr.responseText)
            );
            const obj = JSON.parse(xhr.responseText)
            //console.log(obj.body)
            resptemp = obj.body
            console.log(resptemp)
            //return String(obj.body)
          } else {
            console.log(xhr.responseText);
            reject("Não foi possível obter as negociações do servidor.");
          }
        });
        xhr.send();
      })
    }

    function plotGraph() {
      var temp = resptemp
      var tempMin = Math.min.apply(null, resptemp) -1
      var tempMax =  Math.max.apply(null, resptemp) + 1
      var options = {
        series: [
          {
            name: "fake_clinic_1",
            data: temp
          },
          {
            name: "maxi_permited_temp",
            type: 'line',
            data: [27,27,27,27,27,27,27]
          },
          {
            name: "min_permite temp",
            data: [24,24,24,24,24,24,24]
          }
        ],
        chart: {
          height: 350,
          type: 'line',
          // dropShadow: {
          //   enabled: true,
          //   color: '#000',
          //   top: 18,
          //   left: 7,
          //   blur: 10,
          //   opacity: 0.2
          // },
          toolbar: {
            show: false
          }
        },
        colors: [ '#545454','#16B3DB', "#8F2F51"],
        dataLabels: {
          enabled: true,
        },
        stroke: {
          curve: 'smooth'
        },
        fill: {
          type:'solid',
          opacity: [0.35, 1],
        },
        title: {
          text: 'Temperature',
          align: 'left'
        },
        grid: {
          borderColor: '#e7e7e7',
          row: {
            colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
            opacity: 0.2
          },
        },
        markers: {
          size: 1
        },
        xaxis: {
          categories: [],
          title: {
            text: 'Time frame'
          }
        },
        yaxis: {
          title: {
            text: 'Temperature'
          },
          min: tempMin,
          max: tempMax
        },
        legend: {
          position: 'top',
          horizontalAlign: 'right',
          floating: true,
          offsetY: -25,
          offsetX: -5
        }
      };

      var chart = new ApexCharts(document.querySelector("#chart"), options);
      chart.render();
    }
    async function f1() {
      await getTemp();
      plotGraph();

    }
    f1()
  </script>
  <app-map></app-map>
  <div class="footer">
    Elsa - Latam Builder's Fair 2021 <br>
    © 2021, Amazon Web Services, Inc. or its Affiliates. All rights reserved. Amazon Confidential and Trademark.
  </div>
</body>

</html>